<!DOCTYPE html>
        <html>
        <head>
            <meta charset="utf-8" />
            <title>Not in Archive</title>
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <style>
                .cr-body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 40px 20px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    box-sizing: border-box;
    color: #333;
    /* Always show vertical scrollbar to avoid layout shifts when page content changes height */
    overflow-y: scroll;
}

.cr-body__container {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    border-radius: 12px;
    padding: 40px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.cr-brand-header {
    border-bottom: 2px solid #e9ecef;
    margin-bottom: 30px;
}

.cr-brand-header__link {
    display: flex;
    align-items: center;
    padding-bottom: 20px;
    text-decoration: none;
}

/* Dark mode styles for top of page */
@media (prefers-color-scheme: dark) {
    .cr-body {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d30 100%);
        color: #e0e0e0;
    }

    .cr-body__container {
        background: #2d2d30;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }

    .cr-brand-header {
        border-bottom: 2px solid #404040;
    }
}

.cr-brand-header__logo {
    margin-right: 16px;
    flex-shrink: 0;
}
.cr-brand-header__logo,
.cr-brand-header__logo--image,
.cr-brand-header__logo--image_fallback {
    width: 48px;
    height: 48px;
}

/* Fallback to simplified inline image if full logo image not available */
.cr-brand-header__logo--image_fallback {
    display: none;
}
.cr-brand-header__logo--error .cr-brand-header__logo--image_fallback {
    display: inline;
}
.cr-brand-header__logo--error .cr-brand-header__logo--image {
    display: none;
}

.cr-brand-header__text {
    flex: 1;
}

.cr-brand-header__title {
    margin: 0;
    height: 32px;
    line-height: 1;
}

.cr-brand-header__title img {
    height: 32px;
    width: auto;
    vertical-align: baseline;
}

/* Default to light logotext */
.cr-brand-header__title__logotext--light {
    display: inline;
}
.cr-brand-header__title__logotext--dark {
    display: none;
}

/* Fallback to regular text instead of logotext if logotext images not available */
.cr-brand-header__logotext--text {
    display: none;

    /* NOTE: Duplicated by _BASE_FONT_SIZE and .cr-brand-header__logotext--text font-size */
    font-size: 23px;
    /* NOTE: Duplicated by _LIGHT_TEXT_COLOR and .cr-brand-header__logotext--text color */
    color: #000;
}
.cr-brand-header__logotext--error .cr-brand-header__logotext--text {
    display: inline;
}
.cr-brand-header__logotext--error .cr-brand-header__title__logotext--light,
.cr-brand-header__logotext--error .cr-brand-header__title__logotext--dark {
    display: none;
}

.cr-brand-header__subtitle {
    font-size: 14px;
    color: #6c757d;
    margin: 0;
}

.cr-page__icon {
    font-size: 64px;
    color: #e74c3c;
    text-align: center;
    margin: 20px 0;
}
.cr-page__icon:first-child {
    margin-top: 0;
}

.cr-page__title {
    font-size: 18px;
    color: #2c3e50;
    text-align: center;
    margin: 20px 0;
}

/* Dark mode styles for brand and content */
@media (prefers-color-scheme: dark) {
    .cr-brand-header__subtitle {
        color: #a0a0a0;
    }

    .cr-page__title {
        color: #e0e0e0;
    }

    /* Switch to dark logotext */
    .cr-brand-header__title__logotext--light {
        display: none;
    }
    .cr-brand-header__title__logotext--dark {
        display: inline;
    }

    .cr-brand-header__logotext--text {
        /* NOTE: Duplicated by _DARK_TEXT_COLOR and @media .cr-brand-header__logotext--text color */
        color: #d8d8d8;
    }
}

.cr-page__actions {
    margin: 30px 0;
}
.cr-page__actions:last-child {
    margin-bottom: 0;
}

.cr-button {
    display: inline-block;
    padding: 12px 24px;
    margin: 8px 8px 8px 0;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s ease;
    min-width: 120px;
    text-align: center;

    /* Use consistent height to avoid variance in height from emoji characters */
    height: 48px;
    box-sizing: border-box;
    line-height: 24px;
}

.cr-button--primary {
    background: #4A90E2;
    color: white;
}

.cr-button--primary:hover {
    background: #357ABD;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
}

.cr-button--primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
}

.cr-button--primary:disabled:hover {
    background: #4A90E2;
    transform: none;
    box-shadow: none;
}

.cr-button--secondary {
    background: #6c757d;
    color: white;
}

.cr-button--secondary:hover {
    background: #5a6268;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
}

.cr-button--secondary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
}

.cr-button--secondary:disabled:hover {
    background: #6c757d;
    transform: none;
    box-shadow: none;
}

.cr-url-box {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #4A90E2;
    margin: 20px 0;
}

.cr-url-box__label {
    font-size: 12px;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 5px;
    font-weight: 600;
}

.cr-url-box__link {
    text-decoration: none;
    word-break: break-all;
    font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
    font-size: 14px;
}
.cr-url-box__link[href] {
    color: #4A90E2;
}
.cr-url-box__link[href]:hover {
    text-decoration: underline;
}

/* Dark mode styles for URL */
@media (prefers-color-scheme: dark) {
    .cr-url-box {
        background: #404040;
        border-left: 4px solid #6BB6FF;
    }

    .cr-url-box__label {
        color: #a0a0a0;
    }

    .cr-url-box__link {
        color: #6BB6FF;
    }
}

            </style>
        </head>
        <body class="cr-body">
            <div class="cr-body__container">


                <div class="cr-page__icon">üö´</div>

        <div class="cr-page__title">
            <strong>Page Not in Archive</strong>
        </div>

        <p>The requested page was not found in this archive.</p>

        <div class="cr-url-box">
    <div class="cr-url-box__label">Original URL</div>
    <a class="cr-url-box__link" target="_blank" rel="noopener">
        See browser's URL
    </a>
</div>

        <div class="cr-page__actions">
            <button onclick="history.back()" class="cr-button cr-button--secondary">
                ‚Üê Go Back
            </button>
        </div>
            </div>

            <script>
    const crDefaultUrlPrefixB64 = "aHR0cHM6Ly94a2NkLmNvbQ==";

    // -----------------------------------------------------------------
    // URL Box

    // Calculate the original archive URL based on the request URL
    document.addEventListener('DOMContentLoaded', async () => {
        const loc = document.location;
        if (loc.pathname.endsWith('/404.html')) {
            // 404 page loaded directly. No original URL exists.
            // Leave fallback messaging in place.
            return;
        }

        const requestPath = loc.pathname + loc.search;
        const siteRootPath = await locateSiteRootPath(loc.origin, requestPath);
        const siteRelRequestPath = requestPath.substring(siteRootPath.length - 1);

        const crDefaultUrlPrefix = (crDefaultUrlPrefixB64 !== null)
            ? tryDecodeBase64Utf8(crDefaultUrlPrefixB64)
            : null;
        const archiveUrl = getArchiveUrlWithDup(siteRelRequestPath, crDefaultUrlPrefix);
        if (archiveUrl === null) {
            // Unable to resolve archive URL.
            // Leave fallback messaging in place.
            return;
        }

        // Display the original archive URL
        const urlBoxLinkDom = document.querySelector('.cr-url-box__link');
        urlBoxLinkDom.href = archiveUrl;
        urlBoxLinkDom.innerText = archiveUrl;
    });

    function tryDecodeBase64Utf8(b64Str) {
        try {
            const bytes = Uint8Array.fromBase64(base64);
            return new TextDecoder('utf-8').decode(bytes, {fatal: true});
        } catch (e) {
            if (e instanceof SyntaxError || e instanceof TypeError) {
                // Invalid base64 or UTF-8
                return null;
            } else {
                // API unavailable: Uint8Array, TextDecoder
                try {
                    return atob(b64Str);
                } catch (f) {
                    if (f instanceof InvalidCharacterError) {
                        // Invalid base64 or string is not ASCII.
                        return null;
                    } else {
                        throw f;
                    }
                }
            }
        }
    }

    // Locates the path to the directory containing the exported site,
    // which also will directly contain the "404.html" page.
    async function locateSiteRootPath(origin, pathWithinSiteRoot) {
        let pathSegments = pathWithinSiteRoot.split('/').slice(1);
        pathSegments = pathSegments.slice(0, pathSegments.length - 1);

        // Check each directory level, starting from root, leading up to pathWithinSiteRoot.
        // Look for a "404.html" page matching this 404 page.
        for (let i = 0; i <= pathSegments.length; i++) {
            const candidateDir = '/' + pathSegments.slice(0, i).join('/') + (i > 0 ? '/' : '');
            const candidate404Url = origin + candidateDir + '404.html';

            let content;
            try {
                const response = await fetch(candidate404Url);
                content = await response.text();
            } catch (fetchError) {
                // No 404.html page found here
                continue;
            }

            const match = content.match(/const crDefaultUrlPrefixB64 = ([^;]+);/);
            if (!match) {
                // No Crystal 404.html page found here
                continue;
            }

            let candidateUrlPrefixB64;
            try {
                candidateUrlPrefixB64 = JSON.parse(match[1]);
            } catch (parseError) {
                // Looks like a Crystal 404.html page, but has a bogus crDefaultUrlPrefixB64.
                continue;
            }
            if (candidateUrlPrefixB64 !== crDefaultUrlPrefixB64) {
                // Is a Crystal 404.html page but does not match this 404 page.
                continue
            }

            return candidateDir;
        }

        // Fallback to root if no matching Crystal 404 page was found
        return '/';
    }

    // NOTE: Duplicated in get_archive_url_with_dup() and getArchiveUrlWithDup()
    function getArchiveUrlWithDup(requestPath, defaultUrlPrefix) {
        const match = requestPath.match(/^\/_\/([^\/]+)\/(.+)$/);
        if (match) {
            const scheme = match[1];
            const rest = match[2];
            const archiveUrl = scheme + '://' + rest;
            return archiveUrl;
        } else {
            // If valid default URL prefix is set, use it
            if (defaultUrlPrefix !== null && !defaultUrlPrefix.endsWith('/')) {
                if (!requestPath.startsWith('/')) {
                    throw new Error('Expected path to start with /');
                }
                return defaultUrlPrefix + requestPath;
            } else {
                return null;
            }
        }
    }

    // -----------------------------------------------------------------
</script>
        </body>
        </html>
